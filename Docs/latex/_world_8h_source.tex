\hypertarget{_world_8h_source}{}\doxysection{World.\+h}
\label{_world_8h_source}\index{D:/Repositories/Space Engine/SpaceGame/include/game/level/World.h@{D:/Repositories/Space Engine/SpaceGame/include/game/level/World.h}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#ifndef WORLD\_H}}
\DoxyCodeLine{3 \textcolor{preprocessor}{\#define WORLD\_H}}
\DoxyCodeLine{4 }
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include "{}renderer/Plane.h"{}}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include "{}renderer/Texture.h"{}}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include "{}game/objects/TileMap.h"{}}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <rapidjson/document.h>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <rapidjson/istreamwrapper.h>}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <fstream>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <sstream>}}
\DoxyCodeLine{13 }
\DoxyCodeLine{14 \textcolor{comment}{//Tiles}}
\DoxyCodeLine{15 \textcolor{keyword}{namespace }World}
\DoxyCodeLine{16 \{}
\DoxyCodeLine{17     \textcolor{comment}{//Pixels in one tile}}
\DoxyCodeLine{18     \textcolor{keyword}{const} \textcolor{keywordtype}{float} TILE\_SIZE = 32.0f;}
\DoxyCodeLine{19 }
\DoxyCodeLine{20     \textcolor{comment}{//Level data}}
\DoxyCodeLine{21     \textcolor{keyword}{enum class} LevelID}
\DoxyCodeLine{22     \{}
\DoxyCodeLine{23         LEVEL\_ENTRY,}
\DoxyCodeLine{24 }
\DoxyCodeLine{25         \textcolor{comment}{//Null entry}}
\DoxyCodeLine{26         LEVEL\_NULL}
\DoxyCodeLine{27     \};}
\DoxyCodeLine{28 }
\DoxyCodeLine{29     \textcolor{comment}{//When level data is written, use int value the respective enum value evaluates to}}
\DoxyCodeLine{30 }
\DoxyCodeLine{31     \textcolor{comment}{//Directions -\/ north is +Z axis, south is -\/Z axis, west is +X axis, east is -\/X }}
\DoxyCodeLine{32     \textcolor{keyword}{enum class} Direction : \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char}}
\DoxyCodeLine{33     \{}
\DoxyCodeLine{34         DIRECTION\_NULL,}
\DoxyCodeLine{35         NORTH, NORTHEAST, NORTHWEST,    \textcolor{comment}{//Quads are aligned with vertex 0 and 1 being north facing}}
\DoxyCodeLine{36         SOUTH, SOUTHEAST, SOUTHWEST,    \textcolor{comment}{//Each level is TILE\_SIZE / sqrt(2) up due to geometry}}
\DoxyCodeLine{37         EAST,}
\DoxyCodeLine{38         WEST}
\DoxyCodeLine{39     \};}
\DoxyCodeLine{40 }
\DoxyCodeLine{41     \textcolor{keyword}{enum class} WorldLevel}
\DoxyCodeLine{42     \{}
\DoxyCodeLine{43         \textcolor{comment}{//Above ground}}
\DoxyCodeLine{44         F0 = 0, F1 = 1, F2 = 2, F3 = 3, F4 = 4, F5 = 5,}
\DoxyCodeLine{45         F6 = 6, F7 = 7, F8 = 8, F9 = 9, F10 = 10,}
\DoxyCodeLine{46         \textcolor{comment}{//Below ground}}
\DoxyCodeLine{47         B1 = -\/1, B2 = -\/2, B3 = -\/3, B4 = -\/4, B5 = -\/5,}
\DoxyCodeLine{48         B6 = -\/6, B7 = -\/7, B8 = -\/8, B9 = -\/9, B10 = -\/10,}
\DoxyCodeLine{49     \};}
\DoxyCodeLine{50 }
\DoxyCodeLine{51     \textcolor{keyword}{enum class} MovementPermissions}
\DoxyCodeLine{52     \{}
\DoxyCodeLine{53         \textcolor{comment}{//Basic permission}}
\DoxyCodeLine{54         CLEAR, WALL,}
\DoxyCodeLine{55         \textcolor{comment}{//Slopes -\/ changes character y pos as moves through}}
\DoxyCodeLine{56         STAIRS\_NORTH, STAIRS\_SOUTH, STAIRS\_EAST, STAIRS\_WEST,}
\DoxyCodeLine{57         \textcolor{comment}{//Terrain}}
\DoxyCodeLine{58         WATER, LEDGE\_SOUTH, LEDGE\_NORTH, LEDGE\_EAST, LEDGE\_WEST,}
\DoxyCodeLine{59         \textcolor{comment}{//Level bridge -\/ lets walk into next level so don't need to check outside bounds}}
\DoxyCodeLine{60         LEVEL\_BRIDGE,}
\DoxyCodeLine{61         \textcolor{comment}{//Sprite blocking}}
\DoxyCodeLine{62         SPRITE\_BLOCKING,}
\DoxyCodeLine{63     \};}
\DoxyCodeLine{64 }
\DoxyCodeLine{65     \textcolor{comment}{//Tile arranging classes}}
\DoxyCodeLine{66     \textcolor{keywordtype}{void} tileLevel(TextureQuad* quad, WorldLevel level);}
\DoxyCodeLine{67     \textcolor{keywordtype}{void} SlopeTile(TextureQuad* quad, Direction direction);}
\DoxyCodeLine{68 }
\DoxyCodeLine{69     \textcolor{keyword}{struct }\mbox{\hyperlink{struct_world_1_1_tile_texture}{TileTexture}}}
\DoxyCodeLine{70     \{}
\DoxyCodeLine{71         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} textureX;}
\DoxyCodeLine{72         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} textureY;}
\DoxyCodeLine{73     \};}
\DoxyCodeLine{74 }
\DoxyCodeLine{75     \textcolor{keyword}{struct }\mbox{\hyperlink{struct_world_1_1_tile_loc}{TileLoc}}}
\DoxyCodeLine{76     \{}
\DoxyCodeLine{77         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} x;}
\DoxyCodeLine{78         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} z;}
\DoxyCodeLine{79     \};}
\DoxyCodeLine{80 }
\DoxyCodeLine{81     \textcolor{keyword}{struct }\mbox{\hyperlink{struct_world_1_1_retrieve_permission}{RetrievePermission}}}
\DoxyCodeLine{82     \{}
\DoxyCodeLine{83         MovementPermissions perm;}
\DoxyCodeLine{84         \textcolor{keywordtype}{bool} leaving = \textcolor{keyword}{false};}
\DoxyCodeLine{85     \};}
\DoxyCodeLine{86 }
\DoxyCodeLine{87     \mbox{\hyperlink{struct_world_1_1_tile_loc}{TileLoc}} NextTileInInputDirection(Direction direct, \mbox{\hyperlink{struct_world_1_1_tile_loc}{TileLoc}} tile);}
\DoxyCodeLine{88     \mbox{\hyperlink{struct_world_1_1_retrieve_permission}{RetrievePermission}} retrievePermission(World::LevelID level, World::Direction direction, \mbox{\hyperlink{struct_world_1_1_tile_loc}{World::TileLoc}} loc);}
\DoxyCodeLine{89     \textcolor{keywordtype}{void} ModifyTilePerm(World::LevelID level, World::Direction direction, \mbox{\hyperlink{struct_world_1_1_tile_loc}{World::TileLoc}} loc);}
\DoxyCodeLine{90 }
\DoxyCodeLine{91     \textcolor{keyword}{struct }\mbox{\hyperlink{struct_world_1_1_level_dimensions}{LevelDimensions}}}
\DoxyCodeLine{92     \{}
\DoxyCodeLine{93         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} levelW;}
\DoxyCodeLine{94         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} levelH;}
\DoxyCodeLine{95     \};}
\DoxyCodeLine{96 }
\DoxyCodeLine{97     \textcolor{keyword}{struct }\mbox{\hyperlink{struct_world_1_1_level_data}{LevelData}}}
\DoxyCodeLine{98     \{}
\DoxyCodeLine{99         \textcolor{comment}{//DATA HERE}}
\DoxyCodeLine{100         LevelID id;}
\DoxyCodeLine{101         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} width;}
\DoxyCodeLine{102         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} height;}
\DoxyCodeLine{103         \textcolor{keywordtype}{float} originX;}
\DoxyCodeLine{104         \textcolor{keywordtype}{float} originY;}
\DoxyCodeLine{105         std::vector<WorldLevel> planeHeights;}
\DoxyCodeLine{106         std::vector<Direction> planeDirections;}
\DoxyCodeLine{107         std::vector<MovementPermissions> planePermissions;}
\DoxyCodeLine{108         std::vector<TileTexture> planeTextures;}
\DoxyCodeLine{109     \};}
\DoxyCodeLine{110 }
\DoxyCodeLine{111     \mbox{\hyperlink{struct_world_1_1_level_data}{LevelData}} ParseLevel();}
\DoxyCodeLine{112 }
\DoxyCodeLine{113     \textcolor{keyword}{class }\mbox{\hyperlink{class_world_1_1_level}{Level}}}
\DoxyCodeLine{114     \{}
\DoxyCodeLine{115     \textcolor{keyword}{public}:}
\DoxyCodeLine{116         \textcolor{comment}{//Load level data}}
\DoxyCodeLine{117         \textcolor{keywordtype}{void} buildLevel(\mbox{\hyperlink{class_render_1_1_renderer}{Render::Renderer<TextureVertex>}}* planeRenderer, \mbox{\hyperlink{class_tile_map}{TileMap}}* tileMapPointer);}
\DoxyCodeLine{118         \textcolor{keywordtype}{void} render();}
\DoxyCodeLine{119 }
\DoxyCodeLine{120         \textcolor{comment}{//Static methods}}
\DoxyCodeLine{121         \textcolor{keyword}{static} \mbox{\hyperlink{struct_component2f}{Component2f}} queryOrigin(LevelID level) \{ \textcolor{keywordflow}{if} (s\_LevelOriginCache.find(level) != s\_LevelOriginCache.end()) \{ \textcolor{keywordflow}{return} s\_LevelOriginCache[level]; \} \textcolor{keywordflow}{return} s\_LevelOriginCache.begin()-\/>second; \} \textcolor{comment}{//If fails, return first level origin found}}
\DoxyCodeLine{122         \textcolor{keyword}{static} \mbox{\hyperlink{struct_world_1_1_level_dimensions}{LevelDimensions}} queryDimensions(LevelID level) \{ \textcolor{keywordflow}{if} (s\_LevelDimensionCache.find(level) != s\_LevelDimensionCache.end()) \{ \textcolor{keywordflow}{return} s\_LevelDimensionCache[level]; \} \textcolor{keywordflow}{return} s\_LevelDimensionCache.begin()-\/>second; \} \textcolor{comment}{//If fails, return first level dim found}}
\DoxyCodeLine{123         \textcolor{keyword}{static} std::vector<MovementPermissions>* queryPermissions(LevelID level) \{ \textcolor{keywordflow}{if} (s\_MovementPermissionsCache.find(level) != s\_MovementPermissionsCache.end()) \{ \textcolor{keywordflow}{return} s\_MovementPermissionsCache[level]; \} \textcolor{keywordflow}{return} s\_MovementPermissionsCache.begin()-\/>second; \} \textcolor{comment}{//If fails, return first level permis found}}
\DoxyCodeLine{124         }
\DoxyCodeLine{125         \textcolor{comment}{//Static caches}}
\DoxyCodeLine{126         \textcolor{keyword}{static} std::unordered\_map<LevelID, Component2f> s\_LevelOriginCache;}
\DoxyCodeLine{127         \textcolor{keyword}{static} std::unordered\_map<LevelID, LevelDimensions> s\_LevelDimensionCache;}
\DoxyCodeLine{128         \textcolor{keyword}{static} std::unordered\_map<LevelID, std::vector<MovementPermissions>*> s\_MovementPermissionsCache;}
\DoxyCodeLine{129     \textcolor{keyword}{private}:}
\DoxyCodeLine{130         \textcolor{comment}{//ID}}
\DoxyCodeLine{131         LevelID m\_ID;}
\DoxyCodeLine{132 }
\DoxyCodeLine{133         \textcolor{comment}{//All levels have a rendered plane and a grid of tiles}}
\DoxyCodeLine{134         \mbox{\hyperlink{class_plane}{Plane}} m\_Plane;}
\DoxyCodeLine{135         std::vector<MovementPermissions> m\_Permissions;}
\DoxyCodeLine{136         std::vector<WorldLevel> m\_Heights;}
\DoxyCodeLine{137         \mbox{\hyperlink{class_tile_map}{TileMap}}* m\_TileMapPointer;}
\DoxyCodeLine{138 }
\DoxyCodeLine{139         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} m\_LevelTilesX = 0;}
\DoxyCodeLine{140         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} m\_LevelTilesY = 0;}
\DoxyCodeLine{141         \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} m\_LevelTotalTiles = 0;}
\DoxyCodeLine{142 }
\DoxyCodeLine{143 }
\DoxyCodeLine{144         \textcolor{keywordtype}{float} m\_XOffset = 0.0f; \textcolor{keywordtype}{float} m\_YOffset = 0.0f;}
\DoxyCodeLine{145     \};}
\DoxyCodeLine{146 }
\DoxyCodeLine{147     \textcolor{comment}{//Constants}}
\DoxyCodeLine{148     \textcolor{keyword}{constexpr} \textcolor{keywordtype}{float} WALK\_SPEED = 1.0f;}
\DoxyCodeLine{149     \textcolor{keyword}{constexpr} \textcolor{keywordtype}{float} RUN\_SPEED = 2.0f;}
\DoxyCodeLine{150     \textcolor{keyword}{constexpr} \textcolor{keywordtype}{float} WALK\_DURATION = 1.0f / WALK\_SPEED;}
\DoxyCodeLine{151     \textcolor{keyword}{constexpr} \textcolor{keywordtype}{float} RUN\_DURATION = 1.0f / RUN\_SPEED;}
\DoxyCodeLine{152 \}}
\DoxyCodeLine{153 }
\DoxyCodeLine{154 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
