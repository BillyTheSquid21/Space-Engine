\hypertarget{_script_8hpp_source}{}\doxysection{Script.\+hpp}
\label{_script_8hpp_source}\index{D:/Repositories/Space Engine/SpaceGame/include/game/objects/Script.hpp@{D:/Repositories/Space Engine/SpaceGame/include/game/objects/Script.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#pragma once}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#ifndef GAME\_SCRIPT\_H}}
\DoxyCodeLine{3 \textcolor{preprocessor}{\#define GAME\_SCRIPT\_H}}
\DoxyCodeLine{4 }
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <stdint.h>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <string>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <memory>}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <functional>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include "{}game/objects/OverworldSprite.h"{}}}
\DoxyCodeLine{10 }
\DoxyCodeLine{11 \textcolor{comment}{//Debug Struct for use in creating flags/scripts, which then becomes bool array}}
\DoxyCodeLine{12 \textcolor{keyword}{struct }\mbox{\hyperlink{struct_flag_info}{FlagInfo}}}
\DoxyCodeLine{13 \{}
\DoxyCodeLine{14     \textcolor{keywordtype}{bool} active;}
\DoxyCodeLine{15     uint16\_t location;}
\DoxyCodeLine{16     std::string flagDescription;}
\DoxyCodeLine{17 \};}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{comment}{//Instructions}}
\DoxyCodeLine{20 \textcolor{keyword}{enum class} ScriptInstruction}
\DoxyCodeLine{21 \{}
\DoxyCodeLine{22     \textcolor{comment}{//Core}}
\DoxyCodeLine{23     NO\_OP, SET\_FLAG, JMP, JMP\_IF, WAIT\_SEC, LOCK\_PLAYER, CORE\_MAX, \textcolor{comment}{//max to give return term}}
\DoxyCodeLine{24     }
\DoxyCodeLine{25     \textcolor{comment}{//Non Core}}
\DoxyCodeLine{26     OPEN\_MSG\_BOX, CLOSE\_MSG\_BOX, MSG, CLEAR\_TEXT, GIVE\_ITEM, TAKE\_ITEM,}
\DoxyCodeLine{27     FREEZE\_OBJECT, UNFREEZE\_OBJECT, CGE\_DIRECTION, WALK\_IN\_DIR, RUN\_IN\_DIR, }
\DoxyCodeLine{28     SET\_BUSY,}
\DoxyCodeLine{29 \};}
\DoxyCodeLine{30 }
\DoxyCodeLine{31 \textcolor{comment}{//Message info -\/ using std ints to guarantee bytes}}
\DoxyCodeLine{32 \textcolor{keyword}{struct }\mbox{\hyperlink{struct_m_s_g___i_n_f_o}{MSG\_INFO}}}
\DoxyCodeLine{33 \{}
\DoxyCodeLine{34     \textcolor{comment}{//Which list of text to take from}}
\DoxyCodeLine{35     uint32\_t languageID : 8;}
\DoxyCodeLine{36     uint32\_t listID : 8;}
\DoxyCodeLine{37     \textcolor{comment}{//Where in the list the text instance is}}
\DoxyCodeLine{38     uint32\_t textEntry : 16;}
\DoxyCodeLine{39 \};}
\DoxyCodeLine{40 }
\DoxyCodeLine{41 \textcolor{keyword}{struct }\mbox{\hyperlink{struct_f_l_a_g___i_n_f_o}{FLAG\_INFO}}}
\DoxyCodeLine{42 \{}
\DoxyCodeLine{43     uint32\_t flagLoc : 16;}
\DoxyCodeLine{44     uint32\_t state : 8;}
\DoxyCodeLine{45     uint32\_t unused : 8;}
\DoxyCodeLine{46 \};}
\DoxyCodeLine{47 }
\DoxyCodeLine{48 \textcolor{comment}{//Jump info}}
\DoxyCodeLine{49 \textcolor{keyword}{struct }\mbox{\hyperlink{struct_j_m_p___i_n_f_o}{JMP\_INFO}}}
\DoxyCodeLine{50 \{}
\DoxyCodeLine{51     uint32\_t line : 16;}
\DoxyCodeLine{52     uint32\_t unused : 16;}
\DoxyCodeLine{53 \};}
\DoxyCodeLine{54 }
\DoxyCodeLine{55 \textcolor{comment}{//If info}}
\DoxyCodeLine{56 \textcolor{keyword}{struct }\mbox{\hyperlink{struct_j_m_p___i_f___i_n_f_o}{JMP\_IF\_INFO}}}
\DoxyCodeLine{57 \{}
\DoxyCodeLine{58     uint32\_t flagLoc : 16;}
\DoxyCodeLine{59     uint32\_t line : 16;}
\DoxyCodeLine{60 \};}
\DoxyCodeLine{61 }
\DoxyCodeLine{62 \textcolor{comment}{//Item info}}
\DoxyCodeLine{63 \textcolor{keyword}{struct }\mbox{\hyperlink{struct_i_t_e_m___i_n_f_o}{ITEM\_INFO}}}
\DoxyCodeLine{64 \{}
\DoxyCodeLine{65     uint32\_t itemID : 16;}
\DoxyCodeLine{66     uint32\_t quantity : 16;}
\DoxyCodeLine{67 \};}
\DoxyCodeLine{68 }
\DoxyCodeLine{69 \textcolor{comment}{//Direction info}}
\DoxyCodeLine{70 \textcolor{keyword}{struct }\mbox{\hyperlink{struct_d_i_r_e_c_t_i_o_n___i_n_f_o}{DIRECTION\_INFO}}}
\DoxyCodeLine{71 \{}
\DoxyCodeLine{72     uint32\_t direction : 8; \textcolor{comment}{//as direction is 1 byte can just assign the byte}}
\DoxyCodeLine{73     uint32\_t unused : 24;}
\DoxyCodeLine{74 \};}
\DoxyCodeLine{75 }
\DoxyCodeLine{76 \textcolor{comment}{//Busy info}}
\DoxyCodeLine{77 \textcolor{keyword}{struct }\mbox{\hyperlink{struct_b_u_s_y___i_n_f_o}{BUSY\_INFO}}}
\DoxyCodeLine{78 \{}
\DoxyCodeLine{79     uint32\_t state : 8;}
\DoxyCodeLine{80     uint32\_t unused : 24;}
\DoxyCodeLine{81 \};}
\DoxyCodeLine{82 }
\DoxyCodeLine{83 \textcolor{comment}{//Lock player info}}
\DoxyCodeLine{84 \textcolor{keyword}{struct }\mbox{\hyperlink{struct_l_o_c_k___p_l_a_y_e_r___i_n_f_o}{LOCK\_PLAYER\_INFO}}}
\DoxyCodeLine{85 \{}
\DoxyCodeLine{86     uint32\_t state : 8;}
\DoxyCodeLine{87     uint32\_t unused : 24;}
\DoxyCodeLine{88 \};}
\DoxyCodeLine{89 }
\DoxyCodeLine{90 \textcolor{comment}{//Information on what to do with instruction}}
\DoxyCodeLine{91 \textcolor{keyword}{struct }\mbox{\hyperlink{struct_instruction_info}{InstructionInfo}}}
\DoxyCodeLine{92 \{}
\DoxyCodeLine{93     \textcolor{comment}{//contains different info depending on context -\/ all infos take up 4 contiguous bytes and are laid out differently}}
\DoxyCodeLine{94     \textcolor{keyword}{union}}
\DoxyCodeLine{95     \{}
\DoxyCodeLine{96         \mbox{\hyperlink{struct_m_s_g___i_n_f_o}{MSG\_INFO}} msgInfo;}
\DoxyCodeLine{97         \mbox{\hyperlink{struct_i_t_e_m___i_n_f_o}{ITEM\_INFO}} itemInfo;}
\DoxyCodeLine{98         \mbox{\hyperlink{struct_j_m_p___i_n_f_o}{JMP\_INFO}} jmpInfo;}
\DoxyCodeLine{99         \mbox{\hyperlink{struct_j_m_p___i_f___i_n_f_o}{JMP\_IF\_INFO}} jmpIfInfo;}
\DoxyCodeLine{100         \mbox{\hyperlink{struct_f_l_a_g___i_n_f_o}{FLAG\_INFO}} flgInfo;}
\DoxyCodeLine{101         \mbox{\hyperlink{struct_d_i_r_e_c_t_i_o_n___i_n_f_o}{DIRECTION\_INFO}} dirInfo;}
\DoxyCodeLine{102         \mbox{\hyperlink{struct_b_u_s_y___i_n_f_o}{BUSY\_INFO}} busyInfo;}
\DoxyCodeLine{103         \mbox{\hyperlink{struct_l_o_c_k___p_l_a_y_e_r___i_n_f_o}{LOCK\_PLAYER\_INFO}} lockPlayInfo;}
\DoxyCodeLine{104         uint32\_t clear;}
\DoxyCodeLine{105     \};}
\DoxyCodeLine{106 \};}
\DoxyCodeLine{107 }
\DoxyCodeLine{108 \textcolor{keyword}{struct }\mbox{\hyperlink{struct_script_element}{ScriptElement}}}
\DoxyCodeLine{109 \{}
\DoxyCodeLine{110     ScriptInstruction instruction;}
\DoxyCodeLine{111     \mbox{\hyperlink{struct_instruction_info}{InstructionInfo}} info;}
\DoxyCodeLine{112 \};}
\DoxyCodeLine{113 }
\DoxyCodeLine{114 \textcolor{keyword}{typedef} std::shared\_ptr<ScriptElement[]> Script;}
\DoxyCodeLine{115 \textcolor{keyword}{typedef} std::shared\_ptr<bool[]> FlagArray;}
\DoxyCodeLine{116 }
\DoxyCodeLine{117 \textcolor{comment}{//Script component to be applied to object}}
\DoxyCodeLine{118 \textcolor{keyword}{class }\mbox{\hyperlink{class_overworld_script}{OverworldScript}} : \textcolor{keyword}{public} \mbox{\hyperlink{class_update_component}{UpdateComponent}}}
\DoxyCodeLine{119 \{}
\DoxyCodeLine{120 \textcolor{keyword}{public}:}
\DoxyCodeLine{121     \mbox{\hyperlink{class_overworld_script}{OverworldScript}}(Script script, uint16\_t size, \mbox{\hyperlink{class_ov_spr___running_sprite}{OvSpr\_RunningSprite}}* player) \{ m\_Script = script; m\_Size = size; m\_Player = player; \}}
\DoxyCodeLine{122     \textcolor{keywordtype}{void} update(\textcolor{keywordtype}{double} deltaTime) }
\DoxyCodeLine{123     \{}
\DoxyCodeLine{124         process(m\_Index, deltaTime);}
\DoxyCodeLine{125 }
\DoxyCodeLine{126         \textcolor{keywordflow}{if} (m\_Index >= m\_Size)}
\DoxyCodeLine{127         \{}
\DoxyCodeLine{128             m\_Index = 0;}
\DoxyCodeLine{129         \}}
\DoxyCodeLine{130     \}}
\DoxyCodeLine{131 }
\DoxyCodeLine{132     \textcolor{keyword}{virtual} \mbox{\hyperlink{struct_script_element}{ScriptElement}} process(uint16\_t index, \textcolor{keywordtype}{double} deltaTime)}
\DoxyCodeLine{133     \{}
\DoxyCodeLine{134         \textcolor{comment}{//Carries out core functionality here that all implementations use}}
\DoxyCodeLine{135         \textcolor{comment}{//Then returns the element to derived process}}
\DoxyCodeLine{136         \mbox{\hyperlink{struct_script_element}{ScriptElement}} el = m\_Script[m\_Index];}
\DoxyCodeLine{137         \textcolor{keywordflow}{switch} (el.instruction)}
\DoxyCodeLine{138         \{}
\DoxyCodeLine{139         \textcolor{keywordflow}{case} ScriptInstruction::JMP:}
\DoxyCodeLine{140             m\_Index = el.info.jmpInfo.line;}
\DoxyCodeLine{141             \textcolor{keywordflow}{return} el;}
\DoxyCodeLine{142         \textcolor{keywordflow}{case} ScriptInstruction::JMP\_IF:}
\DoxyCodeLine{143             \textcolor{keywordflow}{if} (m\_FlagArray[el.info.jmpIfInfo.flagLoc])}
\DoxyCodeLine{144             \{}
\DoxyCodeLine{145                 m\_Index = el.info.jmpIfInfo.line;}
\DoxyCodeLine{146             \}}
\DoxyCodeLine{147             \textcolor{keywordflow}{return} el;}
\DoxyCodeLine{148         \textcolor{keywordflow}{case} ScriptInstruction::SET\_FLAG:}
\DoxyCodeLine{149             m\_FlagArray[el.info.flgInfo.flagLoc] = el.info.flgInfo.state;}
\DoxyCodeLine{150             m\_Index++;}
\DoxyCodeLine{151             \textcolor{keywordflow}{return} el;}
\DoxyCodeLine{152         \textcolor{keywordflow}{case} ScriptInstruction::WAIT\_SEC:}
\DoxyCodeLine{153             \textcolor{keywordflow}{if} (m\_Timer >= 1.0f)}
\DoxyCodeLine{154             \{}
\DoxyCodeLine{155                 m\_Index++;}
\DoxyCodeLine{156                 m\_Timer = 0.0f;}
\DoxyCodeLine{157             \}}
\DoxyCodeLine{158             m\_Timer += deltaTime;}
\DoxyCodeLine{159             \textcolor{keywordflow}{return} el;}
\DoxyCodeLine{160         \textcolor{keywordflow}{case} ScriptInstruction::LOCK\_PLAYER:}
\DoxyCodeLine{161             m\_Player-\/>m\_Busy = el.info.lockPlayInfo.state;}
\DoxyCodeLine{162             m\_Index++;}
\DoxyCodeLine{163             \textcolor{keywordflow}{return} el;}
\DoxyCodeLine{164         \}}
\DoxyCodeLine{165         \textcolor{keywordflow}{return} el;}
\DoxyCodeLine{166     \}}
\DoxyCodeLine{167 \textcolor{keyword}{protected}:}
\DoxyCodeLine{168     Script m\_Script;}
\DoxyCodeLine{169     FlagArray m\_FlagArray;}
\DoxyCodeLine{170     uint16\_t m\_Index = 0;}
\DoxyCodeLine{171     uint16\_t m\_Size;}
\DoxyCodeLine{172     \mbox{\hyperlink{class_ov_spr___running_sprite}{OvSpr\_RunningSprite}}* m\_Player;}
\DoxyCodeLine{173 \textcolor{keyword}{private}:}
\DoxyCodeLine{174     \textcolor{keywordtype}{float} m\_Timer = 0.0;}
\DoxyCodeLine{175 \};}
\DoxyCodeLine{176 }
\DoxyCodeLine{177 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
